<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Trawler Production Manager</title>
<style>
body {
  font-family: Arial;
  background:#1e1e1e;
  color:white;
  padding:20px;
}
h2 { text-align:center; }
.section {
  background:#2c2c2c;
  padding:15px;
  margin-top:20px;
  border-radius:8px;
}
input, select, button {
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
  border-radius:5px;
  border:none;
}
button {
  background:#007bff;
  color:white;
}
button:hover { opacity:0.9; }
.deleteBtn { background:#b30000; }
table {
  width:100%;
  margin-top:15px;
  border-collapse: collapse;
  background:#2c2c2c;
}
th, td {
  padding:8px;
  border:1px solid #444;
  text-align:center;
}
.dashboardBox {
  background:#007bff;
  padding:10px;
  border-radius:6px;
  margin:5px 0;
  text-align:center;
  font-weight:bold;
}
</style>
</head>
<body>

<h2>ðŸš¢ Trawler Production Manager</h2>

<div class="section">
<h3>Dashboard</h3>
<div id="totalTons" class="dashboardBox"></div>
<div id="totalEntries" class="dashboardBox"></div>
<div id="topCrew" class="dashboardBox"></div>
</div>

<div class="section">
<h3>Add Catch</h3>
<input type="date" id="date">
<select id="crew"></select>
<input type="number" id="tons" placeholder="Tonnage">
<select id="fish"></select>
<select id="factory"></select>
<button onclick="addEntry()">Add Catch</button>
</div>

<div class="section">
<h3>Filters & Backup</h3>
<input type="month" id="monthFilter" onchange="renderTable()">
<select id="factoryFilter" onchange="renderTable()"></select>
<button onclick="exportCSV()">Export CSV Report</button>
<button onclick="backupData()">Backup All Data</button>
</div>

<div class="section">
<h3>Manage Lists</h3>
<input type="text" id="newCrew" placeholder="Add Crew Name">
<button onclick="addCrew()">Add Crew</button>

<input type="text" id="newFish" placeholder="Add Fish Type">
<button onclick="addFish()">Add Fish</button>

<input type="text" id="newFactory" placeholder="Add Factory">
<button onclick="addFactory()">Add Factory</button>
</div>

<table id="table"></table>

<h3>Totals Per Crew</h3>
<table id="totalsTable"></table>

<h3>Totals Per Fish</h3>
<table id="fishTotalsTable"></table>

<script>

let entries = JSON.parse(localStorage.getItem("entries")) || [];
let crewList = JSON.parse(localStorage.getItem("crewList")) || [];
let fishList = JSON.parse(localStorage.getItem("fishList")) || [];
let factoryList = JSON.parse(localStorage.getItem("factoryList")) || [];

function saveLists(){
  localStorage.setItem("crewList", JSON.stringify(crewList));
  localStorage.setItem("fishList", JSON.stringify(fishList));
  localStorage.setItem("factoryList", JSON.stringify(factoryList));
}

function populateDropdown(id,list,placeholder,includeAll=false){
  const select=document.getElementById(id);
  select.innerHTML="";
  if(includeAll){
    select.innerHTML+=`<option value="">All</option>`;
  } else {
    select.innerHTML+=`<option value="">${placeholder}</option>`;
  }
  list.forEach(item=>{
    select.innerHTML+=`<option>${item}</option>`;
  });
}

function populateAll(){
  populateDropdown("crew",crewList,"Select Crew");
  populateDropdown("fish",fishList,"Select Fish");
  populateDropdown("factory",factoryList,"Select Factory");
  populateDropdown("factoryFilter",factoryList,"All",true);
}

function addCrew(){
  if(!newCrew.value) return;
  crewList.push(newCrew.value);
  saveLists();
  populateAll();
  newCrew.value="";
}

function addFish(){
  if(!newFish.value) return;
  fishList.push(newFish.value);
  saveLists();
  populateAll();
  newFish.value="";
}

function addFactory(){
  if(!newFactory.value) return;
  factoryList.push(newFactory.value);
  saveLists();
  populateAll();
  newFactory.value="";
}

function addEntry(){
  const date=dateInput.value;
  const crew=crew.value;
  const tons=tonsInput.value;
  const fish=fish.value;
  const factory=factory.value;

  if(!date||!crew||!tons||!fish||!factory){
    alert("Fill all fields");
    return;
  }

  entries.push({date,crew,tons,fish,factory});
  localStorage.setItem("entries",JSON.stringify(entries));
  renderTable();
}

function deleteEntry(index){
  if(!confirm("Delete this entry?")) return;
  entries.splice(index,1);
  localStorage.setItem("entries",JSON.stringify(entries));
  renderTable();
}

function renderTable(){

  const monthFilter=document.getElementById("monthFilter").value;
  const factoryFilter=document.getElementById("factoryFilter").value;

  let filtered=entries.filter(e=>{
    let matchMonth=!monthFilter||e.date.startsWith(monthFilter);
    let matchFactory=!factoryFilter||e.factory===factoryFilter;
    return matchMonth&&matchFactory;
  });

  table.innerHTML=`<tr>
  <th>Date</th><th>Crew</th><th>Fish</th><th>Factory</th><th>Tons</th><th>Delete</th>
  </tr>`;

  totalsTable.innerHTML=`<tr><th>Crew</th><th>Total</th></tr>`;
  fishTotalsTable.innerHTML=`<tr><th>Fish</th><th>Total</th></tr>`;

  let crewTotals={}, fishTotals={}, totalTons=0;

  filtered.forEach((e,i)=>{
    table.innerHTML+=`
    <tr>
    <td>${e.date}</td>
    <td>${e.crew}</td>
    <td>${e.fish}</td>
    <td>${e.factory}</td>
    <td>${e.tons}</td>
    <td><button class="deleteBtn" onclick="deleteEntry(${i})">X</button></td>
    </tr>`;

    totalTons+=parseFloat(e.tons);
    crewTotals[e.crew]=(crewTotals[e.crew]||0)+parseFloat(e.tons);
    fishTotals[e.fish]=(fishTotals[e.fish]||0)+parseFloat(e.tons);
  });

  for(let c in crewTotals){
    totalsTable.innerHTML+=`<tr><td>${c}</td><td>${crewTotals[c].toFixed(2)}</td></tr>`;
  }

  for(let f in fishTotals){
    fishTotalsTable.innerHTML+=`<tr><td>${f}</td><td>${fishTotals[f].toFixed(2)}</td></tr>`;
  }

  // Dashboard
  document.getElementById("totalTons").innerText="Total Tons: "+totalTons.toFixed(2);
  document.getElementById("totalEntries").innerText="Total Entries: "+filtered.length;

  let topCrewName="-", max=0;
  for(let c in crewTotals){
    if(crewTotals[c]>max){
      max=crewTotals[c];
      topCrewName=c;
    }
  }
  document.getElementById("topCrew").innerText="Top Crew: "+topCrewName;
}

function exportCSV(){
  let csv="Date,Crew,Fish,Factory,Tons\n";
  entries.forEach(e=>{
    csv+=`${e.date},${e.crew},${e.fish},${e.factory},${e.tons}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="trawler_report.csv";
  a.click();
}

function backupData(){
  const blob=new Blob([JSON.stringify(entries)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="backup_trawler_data.json";
  a.click();
}

populateAll();
renderTable();

</script>

</body>
</html>
