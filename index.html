<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atlantic Leader - Commercial</title>
<link rel="manifest" href="manifest.json">
<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0b1f2a;
    color:white;
}
header{
    background:#06202b;
    padding:15px;
    text-align:center;
    font-weight:bold;
}
.screen{
    display:none;
    padding:15px;
    padding-bottom:80px;
}
.active{
    display:block;
}
.card{
    background:#123848;
    padding:15px;
    border-radius:12px;
    margin-bottom:15px;
}
input, select{
    width:100%;
    padding:8px;
    margin-top:5px;
    margin-bottom:10px;
    border-radius:6px;
    border:none;
}
button{
    background:#0ea5a5;
    border:none;
    padding:10px;
    border-radius:8px;
    color:white;
    font-weight:bold;
}
nav{
    position:fixed;
    bottom:0;
    width:100%;
    display:flex;
    background:#06202b;
}
nav button{
    flex:1;
    padding:12px;
    background:none;
    color:white;
    border:none;
}
</style>
</head>
<body>

<header>Atlantic Leader</header>

<div id="dashboard" class="screen active">
    <div class="card">
        <h3>Active Trip</h3>
        <p id="tripStatus">No Active Trip</p>
    </div>
    <div class="card">
        <h3>Total Tons (Trip)</h3>
        <p id="tripTons">0</p>
    </div>
</div>

<div id="catch" class="screen">
    <div class="card">
        <h3>Add Catch</h3>
        <select id="fishType">
            <option>Sardine</option>
            <option>Anchovy</option>
            <option>Redeye</option>
        </select>
        <select id="crewSelect"></select>
        <input type="number" id="tonnage" placeholder="Tonnage">
        <button onclick="addCatch()">Save Catch</button>
    </div>
</div>

<div id="crew" class="screen">
    <div class="card">
        <h3>Add Crew</h3>
        <input type="text" id="crewName" placeholder="Crew Name">
        <button onclick="addCrew()">Add</button>
    </div>
    <div class="card">
        <h3>Crew List</h3>
        <ul id="crewList"></ul>
    </div>
</div>

<div id="trips" class="screen">
    <div class="card">
        <h3>Start Trip</h3>
        <select id="factory">
            <option>Westpoint</option>
            <option>Amawandle</option>
            <option>Stompneus</option>
        </select>
        <button onclick="startTrip()">Start</button>
    </div>
    <div class="card">
        <button onclick="closeTrip()">Close Trip</button>
    </div>
</div>

<div id="reports" class="screen">
    <div class="card">
        <h3>Crew Totals</h3>
        <ul id="reportList"></ul>
    </div>
</div>

<nav>
<button onclick="show('dashboard')">üè†</button>
<button onclick="show('catch')">üêü</button>
<button onclick="show('crew')">üë®‚Äç‚úàÔ∏è</button>
<button onclick="show('trips')">‚öì</button>
<button onclick="show('reports')">üìä</button>
</nav>

<script>
let db;

let request = indexedDB.open("AtlanticLeaderDB",1);

request.onupgradeneeded = function(e){
    db = e.target.result;
    db.createObjectStore("crew",{keyPath:"id", autoIncrement:true});
    db.createObjectStore("catches",{keyPath:"id", autoIncrement:true});
    db.createObjectStore("trips",{keyPath:"id", autoIncrement:true});
}

request.onsuccess = function(e){
    db = e.target.result;
    loadCrew();
    updateReport();
}

function show(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

function addCrew(){
    let name = document.getElementById("crewName").value;
    if(!name) return;
    let tx = db.transaction("crew","readwrite");
    tx.objectStore("crew").add({name:name});
    tx.oncomplete = function(){
        document.getElementById("crewName").value="";
        loadCrew();
    }
}

function loadCrew(){
    let list = document.getElementById("crewList");
    let select = document.getElementById("crewSelect");
    list.innerHTML="";
    select.innerHTML="";
    let tx = db.transaction("crew","readonly");
    tx.objectStore("crew").openCursor().onsuccess=function(e){
        let cursor = e.target.result;
        if(cursor){
            let li=document.createElement("li");
            li.textContent=cursor.value.name;
            list.appendChild(li);

            let option=document.createElement("option");
            option.value=cursor.key;
            option.textContent=cursor.value.name;
            select.appendChild(option);

            cursor.continue();
        }
    }
}

function startTrip(){
    let factory=document.getElementById("factory").value;
    let tx=db.transaction("trips","readwrite");
    tx.objectStore("trips").add({factory:factory, active:true});
    document.getElementById("tripStatus").innerText="Active - "+factory;
}

function closeTrip(){
    document.getElementById("tripStatus").innerText="No Active Trip";
}

function addCatch(){
    let crewId=document.getElementById("crewSelect").value;
    let tons=parseFloat(document.getElementById("tonnage").value);
    if(!tons) return;

    navigator.geolocation.getCurrentPosition(function(pos){
        let tx=db.transaction("catches","readwrite");
        tx.objectStore("catches").add({
            crew:crewId,
            tons:tons,
            lat:pos.coords.latitude,
            lon:pos.coords.longitude,
            date:new Date()
        });
        tx.oncomplete=function(){
            document.getElementById("tonnage").value="";
            calculateTotals();
        }
    });
}

function calculateTotals(){
    let total=0;
    let tx=db.transaction("catches","readonly");
    tx.objectStore("catches").openCursor().onsuccess=function(e){
        let cursor=e.target.result;
        if(cursor){
            total+=cursor.value.tons;
            cursor.continue();
        } else{
            document.getElementById("tripTons").innerText=total;
            updateReport();
        }
    }
}

function updateReport(){
    let totals={};
    let tx=db.transaction("catches","readonly");
    tx.objectStore("catches").openCursor().onsuccess=function(e){
        let cursor=e.target.result;
        if(cursor){
            totals[cursor.value.crew]=(totals[cursor.value.crew]||0)+cursor.value.tons;
            cursor.continue();
        } else{
            let report=document.getElementById("reportList");
            report.innerHTML="";
            let tx2=db.transaction("crew","readonly");
            tx2.objectStore("crew").openCursor().onsuccess=function(ev){
                let c=ev.target.result;
                if(c){
                    let li=document.createElement("li");
                    li.textContent=c.value.name+" - "+(totals[c.key]||0)+" tons";
                    report.appendChild(li);
                    c.continue();
                }
            }
        }
    }
}
</script>

</body>
</html>
